<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="PL&#x2F;SQL 是 Oracle 自己的一种高级编程语言，可以独立编写程序">
<meta property="og:type" content="article">
<meta property="og:title" content="Oracle PL&#x2F;SQL">
<meta property="og:url" content="http://yoursite.com/2021/05/10/%E6%95%B0%E6%8D%AE%E5%BA%93/Oracle/Oracle%20PLSQL/index.html">
<meta property="og:site_name" content="Pikachu&#39;s Blog">
<meta property="og:description" content="PL&#x2F;SQL 是 Oracle 自己的一种高级编程语言，可以独立编写程序">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-05-10T13:00:00.000Z">
<meta property="article:modified_time" content="2021-07-30T14:58:31.615Z">
<meta property="article:author" content="pikachu">
<meta property="article:tag" content="Oracle">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2021/05/10/%E6%95%B0%E6%8D%AE%E5%BA%93/Oracle/Oracle%20PLSQL/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Oracle PL/SQL | Pikachu's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Pikachu's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/05/10/%E6%95%B0%E6%8D%AE%E5%BA%93/Oracle/Oracle%20PLSQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="pikachu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pikachu's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Oracle PL/SQL
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-10 21:00:00" itemprop="dateCreated datePublished" datetime="2021-05-10T21:00:00+08:00">2021-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-30 22:58:31" itemprop="dateModified" datetime="2021-07-30T22:58:31+08:00">2021-07-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>PL/SQL 是 Oracle 自己的一种高级编程语言，可以独立编写程序</p>
<a id="more"></a>



<p>表类型，记录类型</p>
<p>%Type。%Rowtype。嵌套块。</p>
<p>PL/SQL 中使用 Oracle 中的函数（函数可以正常使用，但是使用组函数需要保证 select 只能返回一条记录）。</p>
<p>PL/SQL 中的 SELECT 语句使用（只能返回一条记录，返回多条或零条都会报错）</p>
<p>在 PL/SQL 中执行 DDL DML 语句，需要使用 execute Immediate</p>
<h3 id="PL-SQL-基本概念："><a href="#PL-SQL-基本概念：" class="headerlink" title="PL/SQL 基本概念："></a>PL/SQL 基本概念：</h3><p>PL/SQL：Procedural Language / SQL</p>
<p>PL/SQL 是 Oracle 数据库中对 SQL 的扩展，SQL 语言只能访问，操作数据库，PL/SQL 是一种高级编程语言，可以独立编写程序。</p>
<p>PL/SQL 可以 使用所有的 SQL 数据操作，函数及运算符，支持 SQL 的全部数据类型。</p>
<p><strong>PL/SQL 的优点：</strong></p>
<ul>
<li>可以把一组语句功能模块化</li>
<li>可以使用过程性语言控制程序结构</li>
<li>可以对程序中的错误捕获并处理</li>
<li>集成在数据库，调用更快</li>
<li>减少了网络交互，提高了程序性能</li>
</ul>
<p><strong>PL/SQL 提供的特性：</strong></p>
<ul>
<li>软件包</li>
<li>触发器</li>
<li>存储过程</li>
<li>函数</li>
<li>异常处理</li>
</ul>
<h3 id="PL-SQL-程序基本结构"><a href="#PL-SQL-程序基本结构" class="headerlink" title="PL/SQL 程序基本结构"></a>PL/SQL 程序基本结构</h3><p>PL/SQL 是块结构语言，其程序包括以下三个部分：</p>
<ol>
<li><strong>声明部分：</strong>以 <code>DECLARE</code> 关键字开头， 定义程序要使用的所有变量，游标，子程序和其它元素。为非必需部分</li>
<li><strong>可执行命令部分：</strong>包含在 <code>BEGIN</code> 和 <code>END</code> 关键字之间，由可执行的 PL/SQL 语句组成，至少含有一个代码行，如果不执行任何操作，则只写一个 <code>NULL</code> 命令。为必需部分。</li>
<li><strong>异常处理部分：</strong>以 <code>EXCEPTION</code> 关键字开头，由异常处理代码组成。非必需部分。</li>
</ol>
<blockquote>
<p>每个 PL/SQL 语句以 <code>;</code> 结尾</p>
</blockquote>
<p><strong>注释：</strong></p>
<ul>
<li>单行注释：<code>--</code></li>
<li>多行注释：<code>/* */</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">-- PL&#x2F;SQL demo</span><br><span class="line">DECLARE</span><br><span class="line">    -- 在 declare 部分声明变量，常量等</span><br><span class="line">    v_name    VARCHAR2(10);</span><br><span class="line">    v_age    NUMBER;</span><br><span class="line">BEGIN</span><br><span class="line">    -- 在 begin 部分写 SQL 语句，可以使用在 declare 中声明的变量和常量</span><br><span class="line">    </span><br><span class="line">    -- 这个就是被 PL&#x2F;SQL 增强的 SQL 语句</span><br><span class="line">    -- INTO 代表把查询出来的结果赋值给 v_name</span><br><span class="line">    SELECT name INTO v_name FROM students WHERE id&#x3D;1;</span><br><span class="line">    SELECT age INTO v_age FROM students WHERE id&#x3D;1;</span><br><span class="line">    </span><br><span class="line">    -- 输出字符串，相当于 Java 中的 system.out.print()</span><br><span class="line">    DBMS_OUTPUT.put_line(&#39;name: &#39; || v_name || &#39;, age: &#39; || v_age);</span><br><span class="line"></span><br><span class="line">EXCEPTION</span><br><span class="line">    &#x2F;*</span><br><span class="line">    在 exception 部分捕获异常并处理异常</span><br><span class="line">    exception 部分不是必须的，可以没有</span><br><span class="line">    *&#x2F;</span><br><span class="line">-- PL&#x2F;SQL 代码块以 END 结尾，END 后面是要有分号的，上面几个关键字没有</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>



<h3 id="PL-SQL-数据类型"><a href="#PL-SQL-数据类型" class="headerlink" title="PL/SQL 数据类型"></a>PL/SQL 数据类型</h3><p><strong>基本类型：</strong>没有内部组件的单个值，如 <code>NUMBER</code>，<code>DATE</code>，<code>BOOLEAN</code>等</p>
<ul>
<li><p>数字类型：</p>
<ul>
<li><code>NUMBER(precision, scale)</code>：可以表示实数范围的数字</li>
</ul>
</li>
<li><p>字符类型：</p>
<ul>
<li><code>CHAR(maximum_length)</code>：定长字符串，最大 32767 字节</li>
<li><code>VERCHAR2(maximum_length)</code>：可变长字符串，最大 32767 字节</li>
</ul>
</li>
<li><p>日期类型：</p>
<ul>
<li><code>DATE</code></li>
</ul>
</li>
<li><p>布尔类型：（<code>BOOLEAN</code> 类型的变量不能用在 SQL 语句中）</p>
<ul>
<li><code>BOOLEAN</code>：有效值（<code>TRUE</code>, <code>FALSE</code>, <code>NULL</code>）</li>
</ul>
</li>
</ul>
<p><strong>大对象类型：</strong>Large OBject (LOB)</p>
<ul>
<li><code>BLOB</code>：存储二进制文件（视频，音频，图片等）</li>
<li><code>CLOB</code>：存储大型字符数据（小说）</li>
</ul>
<p><strong>复合类型：</strong></p>
<blockquote>
<p>复合类型的变量内部可以包含多个组件，每个组件有自己单独的值，一个复合变量可以存放多个值（概念有点类似 Java 的集合）</p>
</blockquote>
<ul>
<li><p><code>TABLES</code>：表类型，类似于 Java 中的数组，也像 Map。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line"></span><br><span class="line">BEGIN</span><br><span class="line"></span><br><span class="line">END;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p><code>RECORDS</code>：记录类型，类似于 Java 中的类，把多个不同类型的变量封装在一块。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line"></span><br><span class="line">BEGIN</span><br><span class="line"></span><br><span class="line">END;</span><br></pre></td></tr></table></figure>




</li>
</ul>
<h3 id="PL-SQL-变量"><a href="#PL-SQL-变量" class="headerlink" title="PL/SQL 变量"></a>PL/SQL 变量</h3><p>PL/SQL 的变量名：</p>
<ul>
<li>可以由 <code>字母</code>，<code>数字</code>，<code>$</code>，<code>_</code> 组成</li>
<li>长度不超过 30 个字符</li>
<li>默认情况不区分大小写</li>
<li>不能使用 PL/SQL 的关键字</li>
</ul>
<p>声明变量：<code>variable_name [CONSTANT] datatype [NOT NULL] [:= | DEFAULT initial_value]</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-- 变量声明是在 DECLARE 部分</span><br><span class="line">DECLARE</span><br><span class="line">    name varchar2(10);</span><br><span class="line">    age number;</span><br><span class="line">    on_the_job boolean default true;</span><br><span class="line">    salary number :&#x3D; 3000;</span><br><span class="line">BEGIN</span><br><span class="line">    name :&#x3D; &quot;jack&quot;</span><br><span class="line">    dbms_output.put_line( name || &quot; salary is: &quot; || salary)</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>



<h3 id="PL-SQL-运算符"><a href="#PL-SQL-运算符" class="headerlink" title="PL/SQL 运算符"></a>PL/SQL 运算符</h3><ul>
<li><p>数学运算符：<code>+, -, *, /, **(乘方)</code></p>
</li>
<li><p>赋值运算符：<code>:=</code></p>
</li>
<li><p>比较运算符：</p>
<ul>
<li>大于小于：<code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code>, <code>&lt;=</code></li>
<li>相等：<code>=</code></li>
<li>不相等：<code>!=</code>，<code>~=</code>，<code>&lt;&gt;</code></li>
</ul>
</li>
<li><p>连接运算符：<code>||</code></p>
</li>
<li><p>逻辑运算符：<code>and</code>, <code>or</code>, <code>not</code></p>
</li>
</ul>
<h3 id="PL-SQL-分支"><a href="#PL-SQL-分支" class="headerlink" title="PL/SQL 分支"></a>PL/SQL 分支</h3><p>基本的使用方式和 Java 没有什么区别，只是关键字不一样：</p>
<p>基本结构：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">IF 条件1 THEN</span><br><span class="line">    语句1;</span><br><span class="line">ELSIF 条件2 THEN</span><br><span class="line">    语句2;</span><br><span class="line">ELSE</span><br><span class="line">    语句3;</span><br><span class="line">END IF;</span><br></pre></td></tr></table></figure>



<p>实例演示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">    v_score number(2) :&#x3D; 99; </span><br><span class="line">BEGIN</span><br><span class="line">   IF v_score &gt; 90 THEN</span><br><span class="line">     dbms_output.put_line(&#39;优秀&#39;);</span><br><span class="line">   ELSIF 60 &lt; v_score and v_score &lt; 90 THEN</span><br><span class="line">     dbms_output.put_line(&#39;合格&#39;);</span><br><span class="line">   ELSE</span><br><span class="line">     dbms_output.put_line(&#39;不及格&#39;);</span><br><span class="line">   END IF;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>





<h3 id="PL-SQL-循环"><a href="#PL-SQL-循环" class="headerlink" title="PL/SQL 循环"></a>PL/SQL 循环</h3><p>使用 <code>LOOP</code> 关键字来定义循环语句：</p>
<p>有三种循环：</p>
<ul>
<li>简单 LOOP 循环</li>
<li>WHILE 循环</li>
<li>FOR 循环</li>
</ul>
<p>基本结构：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-- 简单 LOOP 循环</span><br><span class="line">LOOP</span><br><span class="line">    循环体;</span><br><span class="line">    迭代条件;</span><br><span class="line">    EXIT WHEN 结束循环条件;</span><br><span class="line">END LOOP;</span><br><span class="line"></span><br><span class="line">-- WHILE 循环</span><br><span class="line">WHILE 进入循环条件 LOOP</span><br><span class="line">	循环体;</span><br><span class="line">	迭代条件;</span><br><span class="line">END LOOP;</span><br><span class="line"></span><br><span class="line">-- FOR 循环</span><br><span class="line">-- 循环变量不需要提前定义</span><br><span class="line">-- 下限和上限都是整型数字</span><br><span class="line">FOR 循环变量 IN 下限..上限 LOOP</span><br><span class="line">	循环体;</span><br><span class="line">END LOOP;</span><br></pre></td></tr></table></figure>

<p>实例演示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">-- 简单 LOOP 循环</span><br><span class="line">DECLARE</span><br><span class="line">  V_LOOP  NUMBER(2) :&#x3D; 0;</span><br><span class="line">BEGIN</span><br><span class="line">  LOOP</span><br><span class="line">    dbms_output.put_line(V_LOOP);</span><br><span class="line">    V_LOOP :&#x3D; V_LOOP + 1;</span><br><span class="line">    EXIT WHEN V_LOOP &gt; 10;</span><br><span class="line">  END LOOP;</span><br><span class="line">END;</span><br><span class="line"></span><br><span class="line">-- WHILE 循环</span><br><span class="line">DECLARE</span><br><span class="line">  V_LOOP  NUMBER(2) :&#x3D; 0;</span><br><span class="line">BEGIN</span><br><span class="line">  WHILE V_LOOP &lt; 10 LOOP</span><br><span class="line">    dbms_output.put_line(V_LOOP);</span><br><span class="line">    V_LOOP :&#x3D; V_LOOP + 1;</span><br><span class="line">  END LOOP;</span><br><span class="line">END;</span><br><span class="line">  </span><br><span class="line">-- FOR 循环</span><br><span class="line">-- 输出：1,2,3,4,5,6,7,8,9,10</span><br><span class="line">DECLARE</span><br><span class="line">  </span><br><span class="line">BEGIN</span><br><span class="line">  FOR V_LOOP IN 1 .. 10 LOOP</span><br><span class="line">    dbms_output.put_line(V_LOOP);</span><br><span class="line">  END LOOP;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>





<h3 id="PL-SQL-程序单元"><a href="#PL-SQL-程序单元" class="headerlink" title="PL/SQL 程序单元"></a>PL/SQL 程序单元</h3><p>概念：数据库中命名的 PL/SQL 块</p>
<p>主要有四种：</p>
<blockquote>
<p>普通的 PL/SQL 块，又叫<strong>匿名块</strong>，头部使用 <code>DECLARE</code></p>
</blockquote>
<ul>
<li><p><strong>存储过程</strong>：没有返回值，主要用于执行动作</p>
<p>头部使用：<code>CREATE OR REPLACE PROCEDURE name IS</code></p>
</li>
<li><p><strong>函数</strong>：有返回值，主要用于计算和返回值</p>
<p>头部使用：<code>CREATE OR REPLACE FUNCTION name RETURN datatype IS</code></p>
</li>
<li><p><strong>包</strong>：将逻辑上相关的过程和函数组织在一起</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-- 包头</span><br><span class="line">CREATE OR REPLACE PACKAGE p_name IS</span><br><span class="line">	函数声明;</span><br><span class="line">	过程声明;</span><br><span class="line">END p_name;</span><br><span class="line">-- 包体</span><br><span class="line">CREATE OR REPLACE PACKAGE BODY p_b_name IS</span><br><span class="line">	函数定义;</span><br><span class="line">	过程定义;</span><br><span class="line">END p_b_name;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>触发器</strong>：当出发某些事件时，执行相应的操作</p>
<p><code>TRIGGER name BEFORE|AFTER IS</code></p>
</li>
</ul>
<h4 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h4><p>创建存储过程：把 PL/SQL 块的 <code>DECLARE</code> 替换成 <code>CREATE OR REPLACE PROCEDURE P_NAME IS</code></p>
<p>创建了存储过程，就相当于在 Java 中定义了方法，需要调用才能使方法生效：</p>
<ul>
<li><p>在命令行中调用：<code>EXEC p_name</code></p>
</li>
<li><p>在匿名块中调用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BEGIN</span><br><span class="line">	p_name;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<p>创建带参数的存储过程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">-- 创建带参数的存储过程</span><br><span class="line">CREATE OR REPLACE PROCEDURE ADD_DEPT(P_DEPTNO NUMBER, P_DNAME VARCHAR2, P_LOC VARCHAR2) IS</span><br><span class="line">	-- 这里也可以定义变量</span><br><span class="line">BEGIN</span><br><span class="line">	INSERT INTO DEPT VALUES(P_DEPTNO, P_DNAME, P_LOC);</span><br><span class="line">	COMMIT;</span><br><span class="line">END;</span><br><span class="line"></span><br><span class="line">-- 调用带参数的存储过程，传参的时候有三种方式：</span><br><span class="line">DECLARE</span><br><span class="line">	V_DEPTNO    NUMBER(4)    :&#x3D; 50;</span><br><span class="line">	V_DNAME     VARCHAR2(20) :&#x3D; &#39;技术部&#39;;</span><br><span class="line">	V_LOC       VARCHAR2(30) :&#x3D; &#39;成都&#39;;</span><br><span class="line">BEGIN</span><br><span class="line">	-- 1.按照位置传参</span><br><span class="line">	ADD_DEPT(V_DEPTNO, V_DNAME, V_LOC);</span><br><span class="line">	</span><br><span class="line">	-- 2.按照名称传参，参数位置不受限制</span><br><span class="line">	ADD_DEPT(P_DEPTNO &#x3D;&gt; V_DEPTNO, P_LOC &#x3D;&gt; V_LOC, P_DNAME &#x3D;&gt; V_DNAME);</span><br><span class="line">	</span><br><span class="line">	-- 3.按照位置和名称混合传参，按位置的参数必须在指定的位置，按名称的参数位置随意</span><br><span class="line">	ADD_DEPT(V_DEPTNO, P_LOC &#x3D;&gt; V_LOC, P_DNAME &#x3D;&gt; V_DNAME)</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>



<p>存储过程的参数除了有数据类型之外，还有一种特殊的类型：输入输出类型（<code>IN</code>, <code>OUT</code>, <code>IN OUT</code>）</p>
<p><code>IN</code>：如果不写，默认就是 IN 类型，表示参数仅从外部传入存储过程</p>
<p><code>OUT</code>：表示参数仅从存储过程返回给外部</p>
<p><code>IN OUT</code>：表示参数既可以从外部传入存储过程，又可以返回给外部</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">-- 创建带有 IN OUT 参数类型的存储过程</span><br><span class="line">CREATE OR REPLACE PROCEDURE TEST_IN_OUT(P_IN IN VARCHAR2, P_OUT OUT VARCHAR2, P_IN_OUT IN OUT VARCHAR2) IS</span><br><span class="line"></span><br><span class="line">BEGIN</span><br><span class="line">	DBMS_OUTPUT.put_line(&#39;p_in: &#39; || P_IN);</span><br><span class="line">	DBMS_OUTPUT.put_line(&#39;p_out: &#39; || P_OUT);</span><br><span class="line">	DBMS_OUTPUT.put_line(&#39;p_in_out: &#39; || P_IN_OUT);</span><br><span class="line">	</span><br><span class="line">	P_IN :&#x3D; &#39;存储过程中设置的P_IN的值&#39;;</span><br><span class="line">	P_OUT :&#x3D; &#39;存储过程中设置的P_OUT的值&#39;;</span><br><span class="line">	P_IN_OUT :&#x3D; &#39;储过程中设置的P_IN_OUT的值&#39;;</span><br><span class="line">END;</span><br><span class="line"></span><br><span class="line">-- 调用存储过程</span><br><span class="line">DECLARE</span><br><span class="line">	V_IN      VARCHAR2(30) :&#x3D; &#39;外部设置的P_IN的值&#39;;</span><br><span class="line">	V_OUT     VARCHAR2(30) :&#x3D; &#39;外部设置的P_OUT的值&#39;;</span><br><span class="line">	V_IN_OUT  VARCHAR2(30) :&#x3D; &#39;外部设置的P_IN_OUT的值&#39;;</span><br><span class="line">BEGIN</span><br><span class="line">	TEST_IN_OUT(V_IN, V_OUT, V_IN_OUT);</span><br><span class="line">	</span><br><span class="line">	DBMS_OUTPUT.put_line(&#39;V_in: &#39; || V_IN);</span><br><span class="line">	DBMS_OUTPUT.put_line(&#39;V_out: &#39; || V_OUT);</span><br><span class="line">	DBMS_OUTPUT.put_line(&#39;V_in_out: &#39; || V_IN_OUT);</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>



<h4 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h4><p>创建函数：把 PL/SQL 块的 <code>DECLARE</code> 替换成 <code>CREATE OR REPLACE FUNCTION f_name RETURN datatype IS</code></p>
<blockquote>
<p>函数必须要有返回值</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">-- 定义一个函数</span><br><span class="line">CREATE OR REPLACE FUNCTION FULLNAME(P_FIRSTNAME VARCHAR2, P_LASTNAME VARCHAR2) RETURN VARCHAR2 IS</span><br><span class="line">	V_FULLNAME  VARCHAR2(50);</span><br><span class="line">BEGIN</span><br><span class="line">	V_FULLNAME &#x3D; P_FIRSTNAME || &#39;-&#39; || P_LASTNAME;</span><br><span class="line">	RETURN V_FULLNAME;</span><br><span class="line">END;</span><br><span class="line"></span><br><span class="line">-- 在匿名块中调用函数</span><br><span class="line">DECLARE</span><br><span class="line">	V_FIRSTNAME  VARCHAR2(20)  :&#x3D; &#39;ZHANG&#39;</span><br><span class="line">	V_LASTNAME   VARCHAR2(20)  :&#x3D; &#39;SAN&#39;</span><br><span class="line">	V_FULLNAME   VARCHAR2(50)</span><br><span class="line">BEGIN</span><br><span class="line">	V_FULLNAME :&#x3D; FULLNAME(V_FIRSTNAME, V_LASTNAME);</span><br><span class="line">	DBMS_OUTPUT.put_line(V_FULLNAEM)</span><br><span class="line">END;</span><br><span class="line"></span><br><span class="line">-- 在SQL语句中调用函数</span><br><span class="line">SELECT firstname, lastname, FULLNAME(firstname, lastname)</span><br><span class="line">FROM stu</span><br></pre></td></tr></table></figure>



<p>函数使用的注意事项：</p>
<ul>
<li>函数最常用的地方就是 SQL 语句中</li>
<li>函数中不可以有 DML 语句</li>
<li>函数必须返回 Oracle 支持的数据类型，而不是 PL/SQL 支持的数据类型</li>
<li>Oracle 中自带的函数可以在哪里使用，我们自己定义的函数就可以在哪里使用</li>
</ul>
<h4 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h4><p>概念：触发器是一个类似函数或者过程的命名 PL/SQL 块</p>
<p>特点：在触发事件发生的前或后隐式的运行，不能接收参数</p>
<p>触发事件：可以是对 DML 操作（INSERT，UPDATE，DELETE），也可以是系统事件（像数据库的启动与关闭等）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">-- 创建一个 DML 触发器，表示在向 EMP 表插入数据之前执行相关操作</span><br><span class="line">-- 触发时机有 BEFORE 和 AFTER</span><br><span class="line">CREATE OR REPLACE TRIGGER TR_NAME </span><br><span class="line">	BEFORE INSERT ON EMP</span><br><span class="line">BEGIN </span><br><span class="line">	-- 触发器执行的操作</span><br><span class="line">END;</span><br><span class="line"></span><br><span class="line">-- 触发事件可以有多个，表示更新或者删除 EMP 表的数据时执行相关操作</span><br><span class="line">CREATE OR REPLACE TRIGGER TR_NAME</span><br><span class="line">	BEFORE UPDATE OR DELETE ON EMP</span><br><span class="line">BEGIN</span><br><span class="line"></span><br><span class="line">END;</span><br><span class="line"></span><br><span class="line">------- 上面的触发器属于语句触发器，由相关语句触发 -----------</span><br><span class="line">------- 还有一种触发器是行级触发器，操作每行数据的时候都会执行触发器操作 -----------</span><br><span class="line">CREATE OR REPLACE TRIGGER TR_NAME </span><br><span class="line">	BEFORE INSERT OF SAL ON EMP</span><br><span class="line">	FOR EACH ROW</span><br><span class="line">BEGIN </span><br><span class="line">	-- 触发器执行的操作</span><br><span class="line">	-- 使用行级触发器的时候，使用 :NEW 获取新的数据，使用 :OLD 获取老的数据</span><br><span class="line">	-- 如 :NEW.JOB  :OLD.SAL </span><br><span class="line">END;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>注意：在触发器中不能使用事务</p>
</blockquote>
<h3 id="PL-SQL-游标"><a href="#PL-SQL-游标" class="headerlink" title="PL/SQL 游标"></a>PL/SQL 游标</h3><p>概念：在执行增删改查语句的时候，Oracle 都会开辟一块内存空间，用于暂时存放受 SQL 语句影响的数据，这块内存空间就被称为游标区域</p>
<p>游标分为两类：</p>
<ul>
<li>隐式游标：增删改查语句都会自带隐式游标，隐式游标名称统一为 <code>SQL</code></li>
<li>显式游标：为了 在 PL/SQL 中查询多条记录 而生</li>
</ul>
<p>游标的属性：（显式游标和隐式游标都有下面四个属性）</p>
<ul>
<li><code>%ROWCOUNT</code>：SQL 语句影响的行数</li>
<li><code>%FOUND</code>：游标中是否有数据</li>
<li><code>%NOTFOUND</code>：游标中是否没有数据</li>
<li><code>%ISOPEN</code>：游标是否打开</li>
</ul>
<p>游标属性的使用：<code>游标名.属性</code></p>
<blockquote>
<p>游标在打开前和关闭后都不能使用</p>
</blockquote>
<p>显式游标：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">	-- 定义显式游标，游标天生就和一个有效的SELECT语句绑定</span><br><span class="line">	CURSOR CUR_EMP IS SELECT * FROM EMP;</span><br><span class="line">	-- 声明一个记录类型的变量，用于取出游标中的数据</span><br><span class="line">	V_REC_EMP EMP%ROWTYPE;</span><br><span class="line">BEGIN</span><br><span class="line">	-- 打开游标，会执行与游标绑定的SELECT语句，把查询出来的数据放到游标区域中</span><br><span class="line">	OPEN CUR_EMP;</span><br><span class="line">	-- 取出游标中的 一条 数据放到记录类型变量中</span><br><span class="line">	FETCH CUR_EMP INTO V_REC_EMP;</span><br><span class="line">	-- 从记录类型中取出数据进行使用</span><br><span class="line">	</span><br><span class="line">	-- 关闭游标</span><br><span class="line">	CLOSE CUR_EMP;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果要把游标区域中的数据全部取出来，需要游标搭配循环语句使用，分三种情况：</p>
<ol>
<li><p>LOOP 循环搭配 <code>%NOTFOUND</code> 属性使用</p>
</li>
<li><p>WHILE 循环搭配 <code>%FOUND</code> 属性使用</p>
</li>
<li><p>直接使用 FOR 循环，简单操作游标</p>
<p>FOR 循环会自动声明记录类型变量，自动打开游标，自动取出数据放到变量中，自动关闭游标</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">	-- 定义游标</span><br><span class="line">	CURSOR CUR_EMP IS SELECT * FROM EMP;</span><br><span class="line">BEGIN</span><br><span class="line">	FOR V_REC_EMP IN CUR_EMP LOOP</span><br><span class="line">		-- 操作数据</span><br><span class="line">    END LOOP;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</blockquote>
<h3 id="PL-SQL-异常"><a href="#PL-SQL-异常" class="headerlink" title="PL/SQL 异常"></a>PL/SQL 异常</h3><p>PL/SQL 中的异常和 Java 中的异常概念和处理方式很相似，在 <code>BEGIN</code> 中出现的异常会在 <code>EXCEPTION</code> 中被捕获。</p>
<p>如果异常不被捕获，会传递给调用者</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-- PL&#x2F;SQL中处理异常的基本代码结构</span><br><span class="line">DECLARE</span><br><span class="line">	</span><br><span class="line">BEGIN</span><br><span class="line">	-- 可能出现异常的语句</span><br><span class="line">EXCEPTION</span><br><span class="line">	WHEN exception1 THEN</span><br><span class="line">		statement1;</span><br><span class="line">		statement2;</span><br><span class="line">	WHEN exception2 OR exception3 THEN</span><br><span class="line">		statement1;</span><br><span class="line">		statement1;</span><br><span class="line">	WHEN OTHERS THEN</span><br><span class="line">		statement1;</span><br><span class="line">		statement1;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>



<p>异常类型：</p>
<ul>
<li><p>预定义异常：</p>
<ul>
<li><code>NO_DATA_FOUND</code>：没有找到数据</li>
<li><code>TOO_MANY_ROWS</code>：数据太多</li>
<li><code>INVALID_CURSOR</code>：失效的游标</li>
<li><code>ZERO_DIVID</code>：除零异常</li>
<li><code>DUP_VAL_ON_INDEX</code>：向唯一索引列插入了重复数据</li>
<li><code>VALUE_ERROR</code>：赋值异常</li>
</ul>
</li>
</ul>
<ul>
<li><p>非预定义异常：</p>
<p>如果代码违反了 Oracle 的规则，执行的时候会报错（错误代码 + 错误信息），这种报错 Oracle 并没有定义相应的异常类型，如果我们想要捕获这种错误信息，就需要我们自己去定义异常</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-- 非预定义异常</span><br><span class="line">DECLARE</span><br><span class="line">	-- 自己定义一个异常，类型为EXCEPTION</span><br><span class="line">	E_MYEXCEPTION EXCEPTION;</span><br><span class="line">	-- 把异常和错误代码绑定</span><br><span class="line">	PRAGMA EXCEPTION_INIT(E_MYEXCEPTION, -02292);</span><br><span class="line">BEGIN</span><br><span class="line">	--产生相应异常的代码</span><br><span class="line">EXCEPTION</span><br><span class="line">	WHEN E_MYEXCEPTION THEN</span><br><span class="line">		DBMS_OUTPUT.PUT_LINE(&quot;出现了02292异常&quot;);</span><br><span class="line">	WHEN OTHERS THEN</span><br><span class="line">		DBMS_OUTPUT.PUT_LINE(&quot;出现了其他异常&quot;);</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>用户自定义异常：</p>
<p>当我们想要自己制定一些规则，代码违反规则的时候抛出异常，这种异常我们就需要自己定义</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DECLARE</span><br><span class="line">	-- 自己定义异常</span><br><span class="line">	E_MYEXCEPTION EXCEPTION;</span><br><span class="line">BEGIN</span><br><span class="line">	-- 产生异常的代码</span><br><span class="line">	</span><br><span class="line">	-- 提升自己的异常（其实就和Java中的抛出异常是一个道理）</span><br><span class="line">	RAISE E_MYEXCEPTION;</span><br><span class="line">EXCEPTION</span><br><span class="line">	WHEN E_MYEXCEPTION THEN</span><br><span class="line">		DBMS_OUTPUT.PUT_LINE(&quot;出现了自定义的E_MYEXCEPTION异常&quot;);</span><br><span class="line">	WHEN OTHERS THEN</span><br><span class="line">		DBMS_OUTPUT.PUT_LINE(&quot;出现了其他异常&quot;);</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<p>对于可预见的异常，我们在 WHEN 后面使用特定的异常类型来捕获，但是对于不可预见的异常，我们就需要使用 <code>WHEN OTHERS THEN</code> 来捕获。</p>
<blockquote>
<p>对于非预期异常，通常处理方式是将异常信息写入数据库的错误日志表中</p>
</blockquote>
<p>为了更好的记录异常的日志，Oracle 提供了两个函数：</p>
<ul>
<li><code>SQLCODE</code>：错误代码，<code>NUMBER</code> 类型</li>
<li><code>SQLERRM</code>：错误信息，<code>VARCHAR2</code> 类型</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Oracle/" rel="tag"># Oracle</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/05/08/%E6%95%B0%E6%8D%AE%E5%BA%93/Oracle/Linux%E4%B8%8A%E5%AE%89%E8%A3%85Oracle/" rel="prev" title="在Linux上安装Oracle">
      <i class="fa fa-chevron-left"></i> 在Linux上安装Oracle
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/05/11/Java/%E5%BE%AE%E6%9C%8D%E5%8A%A1/ZooKeeper/" rel="next" title="ZooKeeper">
      ZooKeeper <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#PL-SQL-基本概念："><span class="nav-number">1.</span> <span class="nav-text">PL&#x2F;SQL 基本概念：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PL-SQL-程序基本结构"><span class="nav-number">2.</span> <span class="nav-text">PL&#x2F;SQL 程序基本结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PL-SQL-数据类型"><span class="nav-number">3.</span> <span class="nav-text">PL&#x2F;SQL 数据类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PL-SQL-变量"><span class="nav-number">4.</span> <span class="nav-text">PL&#x2F;SQL 变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PL-SQL-运算符"><span class="nav-number">5.</span> <span class="nav-text">PL&#x2F;SQL 运算符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PL-SQL-分支"><span class="nav-number">6.</span> <span class="nav-text">PL&#x2F;SQL 分支</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PL-SQL-循环"><span class="nav-number">7.</span> <span class="nav-text">PL&#x2F;SQL 循环</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PL-SQL-程序单元"><span class="nav-number">8.</span> <span class="nav-text">PL&#x2F;SQL 程序单元</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#存储过程"><span class="nav-number">8.1.</span> <span class="nav-text">存储过程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#函数"><span class="nav-number">8.2.</span> <span class="nav-text">函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#触发器"><span class="nav-number">8.3.</span> <span class="nav-text">触发器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PL-SQL-游标"><span class="nav-number">9.</span> <span class="nav-text">PL&#x2F;SQL 游标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PL-SQL-异常"><span class="nav-number">10.</span> <span class="nav-text">PL&#x2F;SQL 异常</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">pikachu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">97</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">114</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/PikachuHL" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;PikachuHL" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:faxiang.zhao@qq.com" title="E-Mail → mailto:faxiang.zhao@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">pikachu</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.6.0
  </div>
        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>








        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>














  

  

</body>
</html>
